---
title: "Behavioural Data"
output: html_document
---

```{r setup, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(kableExtra)

data <- read.csv("./data/behavioral_data.csv") # load data

# plot theme
my_theme <- theme(legend.position = "top", 
                  plot.title = element_text(size = 16, hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.5),
                  axis.title = element_text(size = 14),
                  axis.text = element_text(size = 12),
                  axis.line = element_line(colour = "black"),
                  legend.text = element_text(size = 12), 
                  legend.title = element_text(size = 14),
                  panel.background = element_blank(),
                  panel.grid = element_line(colour = "light grey"),
                  strip.text = element_text(size = 12))
```

```{r preprocessing}
# Recode feedback type as string (-1; 1) -> (punishment; reward).
# Recode response as string (-1; 0; 1) -> (right; no go; left).
# Recode response again, but on a broader level: (-1; 1) -> other; 0 -> no go
data <- data %>% 
  mutate(feedback_type_rec = ifelse(feedback_type == 1, "reward", "punishment"),
         response_rec = case_when(response == -1 ~ "right",
                                  response == 1 ~ "left",
                                  response == 0 ~ "no go"),
         response_rec2 = ifelse(response_rec == "no go", "no go", "other"))
```


## The Forssmann Situation

Response times for no go trials show a weird pattern. Usually, any response time > 1.5 s should be correct (reward), anything below should be incorrect (punishment).

```{r}
data %>% 
  filter(condition == "no_go") %>% 
  
  ggplot(aes(x = feedback_type_rec, y = response_time_diff)) +
  geom_jitter(colour = "darkgreen", alpha = .3, size = 2) +
  geom_hline(aes(yintercept = 1.5), colour = "black", size = 1.5, linetype = "dashed") +
  scale_y_continuous(breaks = seq(0, 2, .25)) +
  labs(title = "No-go trials", subtitle = "punished vs. rewarded",
       y = "response time from go cue", x = "feedback") +
  my_theme
```

The same strange pattern occurs for no-go responses in go trials.

```{r}
data %>% 
  filter(condition == "go") %>% 
  
  ggplot(aes(x = feedback_type_rec, y = response_time_diff, colour = response_rec)) +
  geom_jitter(alpha = .4, size = 2) +
  geom_hline(aes(yintercept = 1.5), colour = "black", size = 1.5, linetype = "dashed") +
  scale_y_continuous(breaks = seq(0, 2, .25)) +
  scale_colour_manual("response", values = c("darkblue", "darkgrey", "darkred")) +
  labs(title = "Go trials", subtitle = "punished vs. rewarded",
       y = "response time from go cue", x = "feedback") +
  my_theme
```

We can find out where the two distinct populations of no-go response times are coming from by figuring out when which type (low is < 1.7 s; high is > 1.7 s) occurs when.

```{r}
weird_RTs <- data %>% 
  filter(response_rec == "no go") %>% 
  mutate(response_time_split = ifelse(response_time_diff > 1.7, "high", "low"))
```

Turns out, no-go responses > 1.7 s are associated with one mouse, Forssmann.

```{r}
weird_RTs %>% 
  group_by(response_time_split, mouse) %>%
  count() %>% 
  kable(col.names = c("response time", "mouse", "count")) %>% 
  kable_styling("striped")
```

The weird response times occur in sessions 4, 5, 6 and 7, which are all Forssmann's sessions.

```{r}
weird_RTs %>% 
  group_by(response_time_split, session) %>%
  count() %>% 
  head() %>% # only show first 6 rows
  kable(col.names = c("response time", "session", "count")) %>% 
  kable_styling("striped")
```

Indeed, Forssmann is the culprit. We take him out from now on, since his timing will be messed up.

```{r}
data %>% 
  filter(condition == "no_go") %>% 
  mutate(Forssmann = ifelse(mouse == "Forssmann", "Forssmann", "other mice")) %>% 
  
  ggplot(aes(x = feedback_type_rec, y = response_time_diff, colour = Forssmann)) +
  geom_jitter(alpha = .4, size = 2) +
  geom_hline(aes(yintercept = 1.5), colour = "black", size = 1.5, linetype = "dashed") +
  scale_y_continuous(breaks = seq(0, 2, .25)) +
  scale_colour_manual("", values = c("darkred", "darkgreen")) +
  labs(title = "No-go trials", subtitle = "punished vs. rewarded",
       y = "response time from go cue", x = "feedback") +
  my_theme
```

```{r}
data %>% 
  filter(condition == "go") %>% 
  mutate(Forssmann = ifelse(mouse == "Forssmann", "Forssmann", "other mice")) %>% 
  
  ggplot(aes(x = feedback_type_rec, y = response_time_diff, colour = Forssmann,
             shape = response_rec2)) +
  geom_jitter(alpha = .4, size = 2) +
  geom_hline(aes(yintercept = 1.5), colour = "black", size = 1.5, linetype = "dashed") +
  scale_y_continuous(breaks = seq(0, 2, .25)) +
  scale_colour_manual("", values = c("darkred", "darkgreen")) +
  scale_shape_manual("", values = c(3, 16)) +
  labs(title = "Go trials", subtitle = "punished vs. rewarded",
       y = "response time from go cue", x = "feedback") +
  my_theme
```

